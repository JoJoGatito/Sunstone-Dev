<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Supabase Debug - Sunstone Inclusivity Network</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="debug-supabase.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://www.dyslexiefont.com/css/dyslexie.css" rel="stylesheet" type="text/css"/>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { dyslexie: ["Dyslexie", "sans-serif"] },
        },
      },
    };
  </script>
</head>
<body class="bg-black text-white font-dyslexie">
  <nav class="bg-black p-4">
    <div class="max-w-7xl mx-auto">
      <a href="index.html" class="text-yellow-500 hover:text-yellow-400">
        <i class="fas fa-arrow-left mr-2"></i>Back to Main Page
      </a>
    </div>
  </nav>

  <main class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold text-yellow-500 mb-8">Supabase Connection Debug</h1>
    
    <div class="bg-gray-900 p-6 rounded-lg mb-8">
      <h2 class="text-2xl font-bold text-yellow-500 mb-4">Basic Connection Test</h2>
      <div id="connection-test">
        <p class="text-gray-400">Running connection test...</p>
      </div>
      <div class="mt-4">
        <button id="test-connection" class="px-4 py-2 bg-yellow-500 text-black rounded hover:bg-yellow-400">
          Run Test Again
        </button>
      </div>
    </div>

    <div class="bg-gray-900 p-6 rounded-lg mb-8">
      <h2 class="text-2xl font-bold text-yellow-500 mb-4">Environment Information</h2>
      <div id="environment-info" class="overflow-x-auto">
        <table class="w-full text-sm">
          <tr class="border-b border-gray-800">
            <td class="py-2 pr-4 font-bold">URL</td>
            <td id="env-url" class="py-2"></td>
          </tr>
          <tr class="border-b border-gray-800">
            <td class="py-2 pr-4 font-bold">GitHub Pages</td>
            <td id="env-github" class="py-2"></td>
          </tr>
          <tr class="border-b border-gray-800">
            <td class="py-2 pr-4 font-bold">Protocol</td>
            <td id="env-protocol" class="py-2"></td>
          </tr>
          <tr class="border-b border-gray-800">
            <td class="py-2 pr-4 font-bold">User Agent</td>
            <td id="env-ua" class="py-2"></td>
          </tr>
        </table>
      </div>
    </div>
    
    <div class="bg-gray-900 p-6 rounded-lg">
      <h2 class="text-2xl font-bold text-yellow-500 mb-4">Console Output</h2>
      <pre id="console-output" class="bg-black p-4 rounded text-sm font-mono overflow-x-auto max-h-80">
        <!-- Console output will be displayed here -->
      </pre>
    </div>
  </main>

  <script>
    // Display environment info
    document.getElementById('env-url').textContent = window.location.href;
    document.getElementById('env-github').textContent = window.location.href.includes('github.io') ? 'Yes' : 'No';
    document.getElementById('env-protocol').textContent = window.location.protocol;
    document.getElementById('env-ua').textContent = navigator.userAgent;

    // Capture console output
    const originalConsole = {
      log: console.log,
      error: console.error,
      warn: console.warn
    };

    const consoleOutput = document.getElementById('console-output');
    
    function formatTime() {
      return new Date().toLocaleTimeString();
    }

    console.log = function(...args) {
      originalConsole.log.apply(console, args);
      consoleOutput.innerHTML += `[${formatTime()}] LOG: ${args.join(' ')}\n`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };

    console.error = function(...args) {
      originalConsole.error.apply(console, args);
      consoleOutput.innerHTML += `[${formatTime()}] ERROR: ${args.join(' ')}\n`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };

    console.warn = function(...args) {
      originalConsole.warn.apply(console, args);
      consoleOutput.innerHTML += `[${formatTime()}] WARN: ${args.join(' ')}\n`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };

    // Manual connection test
    document.getElementById('test-connection').addEventListener('click', async function() {
      const connectionTest = document.getElementById('connection-test');
      connectionTest.innerHTML = '<p class="text-gray-400">Running connection test...</p>';
      
      try {
        const { data, error } = await supabase
          .from('groups')
          .select('count')
          .limit(1);
        
        if (error) {
          connectionTest.innerHTML = `
            <div class="bg-red-900/20 border border-red-500 text-red-100 p-4 rounded-lg">
              <p class="font-bold">Connection Failed</p>
              <p class="mt-2">${error.message}</p>
              <p class="mt-2 text-sm">Error Code: ${error.code || 'N/A'}</p>
              <p class="text-sm">Details: ${error.details || 'None'}</p>
            </div>
          `;
        } else {
          connectionTest.innerHTML = `
            <div class="bg-green-900/20 border border-green-500 text-green-100 p-4 rounded-lg">
              <p class="font-bold">Connection Successful</p>
              <p class="mt-2">Successfully connected to Supabase</p>
            </div>
          `;
        }
      } catch (error) {
        connectionTest.innerHTML = `
          <div class="bg-red-900/20 border border-red-500 text-red-100 p-4 rounded-lg">
            <p class="font-bold">JavaScript Error</p>
            <p class="mt-2">${error.message}</p>
            <p class="mt-2 text-sm">${error.stack ? error.stack.split('\n')[0] : ''}</p>
          </div>
        `;
      }
    });

    // Run the test on page load
    document.getElementById('test-connection').click();
  </script>
</body>
</html>